@{
    ViewBag.Title = "Login";
    Layout = "~/Views/Shared/PublicLayout.cshtml";
}




<div class="row m-0">
    <div class="col-4"></div>
    <div class="col-4">
        <h2>Login</h2>
        <div class="form-group">
            <label for="user" class="font-weight-bold"> Login:</label>
            <input type="email" id="txtLogin" class="form-control w-100" placeholder="login" />
        </div>
        <div class="form-group">
            <label for="password" class="font-weight-bold">Password:</label>
            <input type="password" id="txtPassword" class="form-control w-100" placeholder="password" />
        </div>
        <input type="submit" class="btn btn-outline-success font-weight-bold text-success w-25" name="submit" value="submit" id="btnLogin" />
        <a href='@Url.Content("~/User/Register")' class="btn btn-outline-success font-weight-bold text-success w-25">register</a>
        <span style="color:red" id="error"></span>
    </div>
    <div class="col-4"></div>
</div>



@section scripts{

    <script type="text/javascript">
        $(document).ready(function () {
            var basePath = 'https://localhost:44322/';
           
            $("#btnLogin").click(function () {
                var login = $("#txtLogin").val();
                var pass = $("#txtPassword").val();
                var dataToSend = { Login: login, Password: pass };
                var settings = {
                    type: "POST",
                    dataType: "json",
                    url: basePath + "api/Values/Save",
                    data: dataToSend,
                    success: function (result) {
                        if (result.User == null) {
                            $("#error").html("error");
                                }
                        else {
                            sessionStorage.setItem('token', result.token);
                            var dataToSend2 = { "dto": result.User };
                            var settings2 =
                            {
                                type: "POST",
                                dataType: "json",
                                url: "/User/setSession",
                                data: dataToSend2,
                                success: function (result) {
                                    location.href = "/User/Home"
                                },
                                error: function (e) {
                                    alert("session error");
                                }

                            }
                            $.ajax(settings2);
                        }
                    },
                    error: function (e) {
                        alert("User error");
                    }
                };
                $.ajax(settings);
                return false;
            });
        });
    </script>
}
